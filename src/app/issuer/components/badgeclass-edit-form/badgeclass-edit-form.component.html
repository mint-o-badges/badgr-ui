<form-message></form-message>
<app-badge-legend *ngIf="showLegend" (closed)="closeLegend()"></app-badge-legend>

<form [formGroup]="badgeClassForm.rawControl" #formElem (ngSubmit)="onSubmit()" novalidate>
	<!-- Badge Category Panel -->
	<div class="section">
		<div class="tw-flex tw-flex-col tw-gap-2">
			<div class="heading">
				<h2>1. {{ 'CreateBadge.chooseBadgeCategory' | translate }}</h2>
				<bg-formfield-select
					ariaLabel="chooseABadgeCategory"
					[control]="badgeClassForm.rawControlMap.badge_category"
					[placeholder]="chooseABadgeCategory"
					[optionMap]="categoryOptions"
					[errorMessage]="{
						required: chooseABadgeCategory
					}"
				></bg-formfield-select>
			</div>
			<div class="tw-italic tw-gap-2">
				<div class="tw-flex tw-py-2">
					<span class="purpletext">{{ 'Badge.competency' | translate }}-Badges&nbsp; </span>
					<span class="md:tw-hidden"> {{ 'CreateBadge.competencyBadgeShortInfo' | translate }}.</span>
					<span class="tw-hidden md:tw-block">{{ 'CreateBadge.competencyBadgeInfo' | translate }}.</span>
				</div>
				<div class="tw-flex">
					<span class="purpletext">{{ 'Badge.participation' | translate }}-Badges&nbsp; </span>
					<span class="md:tw-hidden"> {{ 'CreateBadge.participationBadgeShortInfo' | translate }}.</span>
					<span class="tw-hidden md:tw-block">{{ 'CreateBadge.participationBadgeInfo' | translate }}.</span>
				</div>
			</div>
		</div>
	</div>

	<div class="section">
		<div>
			<h2 class="heading">2. {{ 'CreateBadge.enterDetails' | translate }}</h2>
		</div>
		<div class="md:tw-mx-10 md:tw-items-center tw-justify-center">
			<div class="field-container tw-items-start">
				<span class="input-label tw-break-words   md:tw-flex-[0_0_10em]">
					{{ 'CreateBadge.short' | translate }}&shy;{{ 'General.description' | translate }}
					{{ 'CreateBadge.forLearners' | translate }}</span
				>
				<bg-formfield-text
					class="tw-mt-1 md:tw-mt-0 tw-w-full tw-max-w-[750px]"
					[control]="badgeClassForm.rawControlMap.badge_description"
					id="badgeclass_description_input"
					[placeholder]="summarizedDescription"
					[errorMessage]="{ required: enterDescription }"
					[multiline]="true"
				></bg-formfield-text>
			</div>
			<div class="field-container md:tw-items-center tw-justify-start">
				<span class="input-label   md:tw-flex-[0_0_10em]"> {{ 'RecBadgeDetail.duration' | translate }}</span>
				<div class="tw-flex tw-gap-2 tw-items-center">
					<bg-formfield-text
						class="tw-w-20"
						[control]="badgeClassForm.rawControlMap.badge_study_load"
						[fieldType]="'number'"
					></bg-formfield-text>
					<span class="tw-text-black">{{ 'General.minutes' | translate }}</span>
				</div>
			</div>
			<div class="field-container md:tw-items-center tw-justify-start">
				<span class="input-label   md:tw-flex-[0_0_10em]"> {{ 'Badge.title' | translate }}</span>

				<bg-formfield-text
					[control]="badgeClassForm.rawControlMap.badge_name"
					[placeholder]="max70chars"
					[errorMessage]="{
						required: 'Bitte gib dem Badge einen Titel',
						mustChange: 'Bitte Ã¤ndere den Titel'
					}"
					[autofocus]="true"
				></bg-formfield-text>
			</div>
			<div class="field-container" id="imageSection" #imageSection>
				<span class="input-label   md:tw-flex-[0_0_10em]"> Badge-{{ 'Issuer.image' | translate }}</span>
				<div
					class="tw-flex tw-flex-col tw-gap-4 md:tw-flex-row tw-bg-[var(--color-lightgreen)] tw-p-8 tw-justify-evenly tw-items-center tw-mr-auto tw-rounded-2xl"
				>
					<div class="tw-w-full">
						<bg-formfield-image
							#imageField
							[label]="useOurEditor"
							[sublabel]="imageSublabel"
							[text_body]="selectFromMyFiles"
							dropZoneInfo1="Drag & Drop"
							[dropZoneInfo2]="chooseFromExistingIcons"
							imageLoaderName="badge"
							[newDropZone]="true"
							[generateRandom]="false"
							[type]="'badge'"
							(generateRandomImage)="generateRandomImage()"
							(imageUploaded)="generateUploadImage($event, badgeClassForm.value)"
							[placeholderImage]="badgeClassPlaceholderImageUrl"
							[control]="badgeClassForm.rawControlMap.badge_image"
							[errorMessage]="imageErrorFork"
						>
						</bg-formfield-image>
						<span class="tw-italic tw-text-sm md:tw-flex md:tw-justify-center md:tw-items-center"
							>{{ 'General.fileformats' | translate }}: SVG {{ 'General.and' | translate }} PNG</span
						>
					</div>
					<hr
						class="md:tw-hidden tw-my-8 tw-w-full tw-border tw-border-[var(--color-purple)] tw-border-dashed"
					/>
					<div class="tw-w-full">
						<bg-formfield-image
							#customImageField
							[label]="useOwnVisual"
							[sublabel]="uploadOwnDesign"
							[text_body]="uploadOwnVisual"
							imageLoaderName="basic"
							[newDropZone]="true"
							[type]="'badge'"
							[generateRandom]="false"
							(generateRandomImage)="generateRandomImage()"
							(imageUploaded)="generateCustomUploadImage($event)"
							[placeholderImage]="badgeClassPlaceholderImageUrl"
							[control]="badgeClassForm.rawControlMap.badge_customImage"
							[errorMessage]="imageErrorFork"
						>
						</bg-formfield-image>
						<span class="tw-italic tw-text-sm md:tw-flex md:tw-justify-center md:tw-items-center"
							>{{ 'General.fileformats' | translate }}: SVG {{ 'General.and' | translate }} PNG</span
						>
					</div>
					<badge-studio
						[scrolled]="scrolled"
						#badgeStudio
						[formData]="badgeClassForm.value"
						[hidden]="true"
					></badge-studio>
				</div>
			</div>
			<p
				id="imageTextError"
				[hidden]="!imageFieldDirty || !badgeClassForm.hasError('imageRequired')"
				class="u-text u-margin-bottom2x u-text-error tw-w-full tw-text-center tw-mt-2"
			>
				{{ 'CreateBadge.imageRequiredError' | translate }}.
			</p>
		</div>
	</div>

	<div class="section tw-px-1" *ngIf="badgeCategory === 'competency'">
		<h2 class="heading">3. {{ 'CreateBadge.fillWithCompetencies' | translate }}</h2>
		<ul class="tw-list-disc md:tw-mx-10 tw-mx-4">
			<li>
				<div>
					<span
						class="md:tw-text-xl tw-text-lg tw-font-semibold md:tw-leading-10 tw-text-[var(--color-purple)]"
						>{{ 'CreateBadge.useAiAssistant' | translate }}</span
					>
					<p class="tw-my-2">{{ 'CreateBadge.enterAiDescription' | translate }}</p>
					<p class="tw-my-2">{{ 'CreateBadge.NoPersonalInformation' | translate }}</p>
					<p class="tw-mb-2">{{ 'CreateBadge.addAiCompetencies' | translate }}</p>
				</div>
				<div
					class="tw-flex tw-flex-col tw-justify-center tw-items-center tw-mt-8 tw-p-4 tw-bg-[var(--color-purple)] tw-rounded-md tw-mx-auto"
				>
					<span
						class="tw-text-[var(--color-green)] tw-font-extrabold tw-text-xl tw-leading-10 tw-text-center tw-py-2 tw-px-4"
						>{{ 'CreateBadge.aiAssistant' | translate }}</span
					>
					<hr class="tw-my-2 tw-mx-10 tw-w-full tw-border tw-border-solid tw-border-[var(--color-green)]" />
					<div class="tw-flex tw-flex-col md:tw-flex-row md:tw-gap-20 tw-w-full md:tw-p-16">
						<div class="tw-flex tw-flex-col">
							<h2 class="tw-text-white tw-uppercase tw-font-bold">
								{{ 'CreateBadge.myContentDescription' | translate }}
							</h2>
							<span class="tw-font-thin tw-italic tw-text-white">{{
								'CreateBadge.min70max1000Chars' | translate
							}}</span>
							<textarea
								class="tw-bg-white tw-border tw-border-gray-300 tw-mt-2 tw-rounded-md tw-shadow-sm tw-p-2 tw-h-48 tw-resize-none tw-text-sm tw-text-gray-700"
								[(ngModel)]="aiCompetenciesDescription"
								[ngModelOptions]="{ standalone: true }"
								maxlength="1000"
								minlength="70"
								[placeholder]="detailedDescription"
							>
							</textarea>
							<div class="tw-mt-4">
								<button
									class="button tw-bg-[var(--color-green)] tw-text-[var(--color-purple)]"
									(click)="suggestCompetencies()"
									type="button"
								>
									<span class="tw-font-bold">
										{{ 'CreateBadge.suggestCompetencies' | translate }}
									</span>
								</button>
							</div>
						</div>
						<div class="tw-mt-6 md:tw-mt-0 tw-w-full">
							<h2 class="tw-text-white tw-uppercase tw-font-bold">
								{{ 'CreateBadge.fitting' | translate }} {{ 'RecBadgeDetail.competencies' | translate }}
							</h2>
							<div
								class="tw-bg-[var(--color-lightpurple)] tw-mt-2 tw-border tw-border-gray-300 tw-rounded-2xl tw-shadow-sm tw-p-2 tw-h-24 tw-resize-none tw-text-sm tw-text-gray-700"
								*ngIf="aiCompetenciesSuggestions.length == 0; else showAiCompetenciesSuggestions"
							>
								<p class="tw-italic tw-whitespace-pre-wrap">
									{{ 'CreateBadge.suggestedCompetencies' | translate }}
								</p>
							</div>
							<ng-template #showAiCompetenciesSuggestions>
								<ng-container
									*ngFor="
										let aiCompetency of badgeClassForm.controls.aiCompetencies.controls;
										let i = index
									"
								>
									<div
										[ngClass]="
											aiCompetency.rawControlMap.selected.value
												? 'tw-bg-[var(--color-lightgreen)]'
												: 'tw-bg-[var(--color-lightpurple)]'
										"
										class="tw-rounded-md md:tw-w-2/3 tw-mx-auto md:tw-ml-0 tw-p-4 tw-mt-2"
									>
										<div class="tw-flex tw-justify-between">
											<h2 class="tw-whitespace-pre-wrap tw-text-black tw-font-bold">
												{{ aiCompetenciesSuggestions[i].preferred_label }}
											</h2>
											<label
												for="checkboxAiSkill$i"
												[ngClass]="
													aiCompetency.rawControlMap.selected
														? 'checkbox checkbox-center'
														: ''
												"
											>
												<input
													id="checkboxAiSkill$i"
													name="checkboxAiSkill$i"
													type="checkbox"
													[formControl]="aiCompetency.rawControlMap.selected"
												/>
											</label>
										</div>
										<p class="tw-w-full tw-mt-2 tw-italic tw-whitespace-pre-wrap">
											{{ aiCompetenciesSuggestions[i].description }}
										</p>
										<div class="tw-flex tw-gap-2 tw-items-center tw-mt-4">
											<label class="tw-text-black tw-font-bold" for="studyLoad$i">
												{{ 'General.minutes' | translate }}:
											</label>
											<bg-formfield-text
												class="tw-max-w-24"
												[control]="aiCompetency.rawControlMap.studyLoad"
												[fieldType]="'number'"
												[errorMessage]="{
													required: 'Bitte gib die Dauer fÃ¼r den Erwerb der Kompetenz ein.'
												}"
											></bg-formfield-text>
										</div>
									</div>
								</ng-container>
							</ng-template>
						</div>
					</div>
				</div>
			</li>
			<hr class="tw-my-8 tw-border tw-border-[var(--color-purple)] tw-border-dashed" />
			<li>
				<span class="tw-text-lg tw-font-bold tw-leading-10 tw-text-[var(--color-purple)]">{{
					'CreateBadge.addCompetenciesByHand' | translate
				}}</span>
				<div
					class="tw-flex tw-flex-col md:tw-flex-row md:tw-gap-4 tw-gap-2 md:tw-justify-between md:tw-items-center"
				>
					<p class="tw-text-black tw-font-semibold">
						{{ 'CreateBadge.addCompetenciesByHandInfo' | translate }}
						<span class="tw-hidden md:tw-inline"
							>, {{ 'CreateBadge.tofindFittingCompetencies' | translate }}</span
						>
					</p>
					<button class="button tw-bg-[var(--color-purple)]">
						<a
							class="tw-text-white"
							href="https://esco.ec.europa.eu/de/classification/skill_main"
							target="_blank"
							>{{ 'CreateBadge.toEscoSearch' | translate }}</a
						>
					</button>
				</div>

				<ng-container *ngFor="let competency of badgeClassForm.controls.competencies.controls; let i = index">
					<ng-container *ngIf="competency.controls['added'].value; else competencyForm">
						<div
							class="tw-bg-[var(--color-lightgreen)] tw-rounded-2xl tw-border tw-border-solid tw-border-black tw-p-4 tw-mt-2"
						>
							<div class="tw-flex tw-justify-between">
								<h2 class="tw-whitespace-pre-wrap tw-text-black tw-font-bold">
									{{ competency.rawControlMap.name.value }}
								</h2>
								<label for="competency$i" class="tw-bg-[var(--color-purple)] checkbox checkbox-center">
									<input
										class="tw-bg-[var(--color-purple)]"
										id="competency$i"
										name="competency$i"
										type="checkbox"
										[formControl]="competency.rawControlMap.added"
									/>
								</label>
							</div>
							<p
								class="tw-w-full tw-font-semibold tw-mt-2 tw-italic tw-whitespace-pre-wrap tw-line-clamp-3"
							>
								{{ competency.rawControlMap.description.value }}
							</p>
							<div class="tw-flex tw-gap-2 tw-items-center tw-mt-4">
								<label class="tw-text-black tw-font-bold" for="studyLoad$i">
									{{ 'General.minutes' | translate }}:
								</label>
								<span
									class="tw-flex tw-rounded-md tw-bg-white tw-border tw-border-solid tw-border-black tw-h-8 tw-w-8 tw-items-center tw-justify-center"
									>{{ competency.rawControlMap.studyLoad.value }}</span
								>
							</div>
						</div>
					</ng-container>
					<ng-template #competencyForm>
						<div
							class="tw-border-[var(--color-purple)] tw-border tw-border-solid tw-rounded-md tw-p-4 tw-mt-4"
						>
							<div class="tw-flex tw-flex-col md:tw-flex-row md:tw-justify-between md:tw-mx-8">
								<bg-formfield-text
									class="tw-mt-4"
									[control]="competency.rawControlMap.name"
									[label]="competencyTitle"
									[fieldType]="'text'"
									[errorMessage]="{
										required: titleError
									}"
								></bg-formfield-text>
								<div class="tw-flex tw-flex-col tw-mt-4">
									<span class="competencyDuration">{{ competencyDuration }}</span>

									<div class="tw-flex tw-gap-2 tw-items-center">
										<bg-formfield-text
											class="tw-max-w-24"
											[control]="competency.rawControlMap.studyLoad"
											[fieldType]="'number'"
											[errorMessage]="{
												required: 'Bitte gib die Dauer fÃ¼r den Erwerb der Kompetenz ein.'
											}"
										></bg-formfield-text>
										<span class="tw-font-bold">{{ 'General.minutes' | translate }}</span>
									</div>
								</div>
								<bg-formfield-select
									class="tw-mt-4"
									ariaLabel="WÃ¤hle eine Kompetenz-Kategorie"
									[control]="competency.rawControlMap.category"
									[label]="competencyCategory"
									[placeholder]="'Kategorie wÃ¤hlen'"
									[optionMap]="competencyCategoryOptions"
									[errorMessage]="{
										required: competencyCategoryError
									}"
								></bg-formfield-select>
							</div>
							<bg-formfield-text
								class="md:tw-mx-8 tw-mt-4"
								[control]="competency.rawControlMap.description"
								[label]="competencyDescription"
								id="competency_description_input"
								[errorMessage]="{ required: enterDescription }"
								[multiline]="true"
							></bg-formfield-text>
							<bg-formfield-text
								class="md:tw-mx-8 tw-mt-4"
								[control]="competency.rawControlMap.escoID"
								label="Esco-Identifier (optional)"
								id="competency_description_input"
								placeholder="z.B. esco/skill/00090cc1-1f27-439e-a4e0-19a87a501bfc"
							></bg-formfield-text>
							<div
								class="l-flex l-flex-1x l-flex-justifybetween u-margin-bottom2x"
								style="margin-top: 2em"
							>
								<button
									*ngIf="badgeClassForm.controls.competencies.controls.length > 0"
									type="button"
									(click)="removeCompetency(competency)"
									class="u-text-link"
								>
									{{ 'General.remove' | translate }}
								</button>
								<button
									type="button"
									(click)="addCompetency(competency)"
									class="button tw-text-white tw-bg-[var(--color-purple)]"
								>
									{{ 'General.add' | translate }}
								</button>
							</div>
						</div>
					</ng-template>
				</ng-container>
				<div class="tw-w-full">
					<button
						type="button"
						(click)="addAnotherCompetency()"
						class="button tw-text-white tw-bg-[var(--color-purple)] tw-items-center tw-flex tw-gap-2 tw-mt-2 tw-ml-auto"
					>
						<svg
							xmlns="http://www.w3.org/2000/svg"
							fill="white"
							height="16px"
							width="16px"
							viewBox="0 0 448 512"
						>
							<!--!Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
							<path
								d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"
							/>
						</svg>

						<span>
							{{
								badgeClassForm.controls.competencies.controls.length > 0
									? ('CreateBadge.addAnotherCompetency' | translate)
									: ('General.add' | translate)
							}}
						</span>
					</button>
				</div>
			</li>
		</ul>
	</div>

	<div class="section">
		<h2 class="heading"><ng-container>{{ badgeCategory === 'competency' ? '4.' : '3.'}}</ng-container> Badge-{{ 'RecBadgeDetail.criteria' | translate }}</h2>
		<div class="md:tw-mx-6">
			<p class="tw-my-2 tw-italic tw-font-semibold">
				{{ 'CreateBadge.criteriaInfo' | translate }}
			</p>
			<div class="mdeditor">
				<div class="mdeditor-x-editor">
					<p
						[hidden]="!alignmentFieldDirty || !badgeClassForm.hasError('criteriaRequired')"
						class="u-text u-margin-bottom2x u-text-error"
					>
						{{ 'CreateBadge.criteriaError' | translate }}
					</p>

					<bg-formfield-markdown
						[control]="badgeClassForm.rawControlMap.badge_criteria_text"
						[newValue]="badgeClassForm.rawControlMap.badge_criteria_text.value"
						label=" Wie bekommt man dieses Badge?"
						class="tw-hidden"
						[errorMessage]="''"
					></bg-formfield-markdown>
					<!-- <textarea id="criteria_textarea" class="tw-my-2" readonly>
						{{criteriaText}}
					</textarea> -->
					 <div >
						<span *ngIf="badgeClassForm.controls.badge_name.value" class="tw-text-lg">
							Du hast erfolgreich an
							<span class="tw-italic tw-font-semibold">{{ badgeClassForm.controls.badge_name.value + ' ' }}</span> teilgenommen.</span
						>
						<div *ngIf="badgeCategory === 'competency'">
							<span class="tw-font-bold tw-text-lg">Dabei hast du folgende Kompetenzen gestÃ¤rkt: </span>
							<ul class="tw-list-disc tw-mt-4">
								<ng-container
									*ngFor="
										let aiCompetency of badgeClassForm.controls.aiCompetencies.controls;
										let i = index
									"
								>
									<li *ngIf="aiCompetency.rawControlMap.selected.value" class="tw-mx-6">
										<span class="tw-text-lg">
											{{ aiCompetenciesSuggestions[i].preferred_label }}
										</span>
									</li>
								</ng-container>
								<ng-container *ngFor="let competency of badgeClassForm.controls.competencies.controls">
									<li *ngIf="competency.rawControlMap.added.value && competency.rawControlMap.name.value" class="tw-mx-6">
										<span class="tw-text-lg">{{ competency.rawControlMap.name.value }}</span>
									</li>
								</ng-container>
							</ul>
						</div>
					</div> 
				</div>

				<!-- <div class="forminput u-margin-bottom2x md:tw-items-center tw-flex tw-gap-2 md:tw-flex-row tw-flex-col">
					<span class="tw-font-bold tw-whitespace-nowrap">URL (optional)</span>
					<bg-formfield-text
						class="tw-w-full"
						[control]="badgeClassForm.rawControlMap.badge_criteria_url"
						[urlField]="true"
						fieldType="url"
						errorMessage="URL zu den Badge Kriterien"
					></bg-formfield-text>
				</div>  -->
			</div>
		</div>
	</div>

	<!-- add options -->
	<div class="section formsection formsection-nohelp">
		<h2 class="tw-pt-1 tw-px-1 tw-text-xl tw-text-[var(--color-purple)]">Optionale Badge-Details</h2>
		<div class="formsection-x-body">
			<div class="tw-flex tw-gap-4 tw-items-center tw-mb-2 tw-mt-8">
				<span class="tw-font-semibold tw-text-lg tw-text-black tw-uppercase"> Tag</span>

				<div class="ng-autocomplete">
					<ng-autocomplete
						name="addtag"
						id="addtag"
						#newTagInput
						[data]="existingTags"
						maxlength="50"
						[isLoading]="existingTagsLoading"
						searchKeyword="name"
						[placeholder]="newTag"
						(keypress)="handleTagInputKeyPress($event)"
						[itemTemplate]="itemTemplate"
						[notFoundTemplate]="notFoundTemplate"
					>
					</ng-autocomplete>

					<ng-template #itemTemplate let-item>
						<a [innerHTML]="item.name"></a>
					</ng-template>

					<ng-template #notFoundTemplate let-notFound>
						<div>{{ 'CreateBadge.tagDoesNotExist' | translate }}</div>
					</ng-template>
				</div>

				<button type="button" (click)="addTag()" class="button tw-ml-auto tw-bg-[var(--color-purple)]">
					{{ 'General.add' | translate }}
				</button>
			</div>
			<div *ngIf="tags.size > 0" class="tw-flex tw-flex-wrap tw-gap-4 tw-w-1/2 tw-ml-8">
				<div
					class="tw-flex tw-items-center tw-bg-white tw-rounded-full tw-px-3 tw-py-1 tw-mr-2 tw-mb-2"
					*ngFor="let tag of tags"
				>
					<button (click)="removeTag(tag)">
						<span> {{ tag }}</span>
						<svg class="tw-ml-1" icon="icon_close" width="12px" height="12px"></svg>
						<span class="visuallyhidden">Close</span>
					</button>
				</div>
			</div>
			<span class="tw-italic">{{ 'CreateBadge.tagInfo' | translate }}</span>
			<ul class="tw-mt-4">
				<li>
					<button
						type="button"
						(click)="alignmentsEnabled ? disableAlignments() : enableAlignments()"
						class="options-dropdown"
					>
						<span class="tw-text-md md:tw-text-lg">
							{{ 'CreateBadge.alignEducationalFramework' | translate }}
						</span>
					</button>
					<!-- alignments -->
					<div class="formsection tw-mt-2 tw-bg-inherit tw-border-none" *ngIf="alignmentsEnabled">
						<div class="formsection-x-title">
							<h2 class="u-text-dark2">
								{{ 'RecBadgeDetail.alignment' | translate }}
								<span>(Optional)</span>
							</h2>
							<button type="button" (click)="disableAlignments()" class="buttonicon buttonicon-link">
								<svg icon="icon_close"></svg>
								<span class="visuallyhidden">Close</span>
							</button>
						</div>

						<div class="formsection-x-help">
							<h3 class="u-text-body-bold">
								{{ 'CreateBadge.whatIsThe' | translate }} {{ 'RecBadgeDetail.alignment' | translate }}?
							</h3>
							<p class="u-text u-margin-top1x u-margin-bottom2x">
								{{ 'CreateBadge.alignmentInfo' | translate }}
							</p>
						</div>
						<div class="formsection-x-body">
							<ng-container
								*ngFor="let alignment of badgeClassForm.controls.alignments.controls; let i = index"
							>
								<div class="tw-mt-2 l-flex l-flex-1x l-flex-justifybetween u-margin-bottom2x">
									<h3 class="u-text-body-bold u-text-dark1">
										{{ alignment.controls.target_name.value }}
									</h3>
									<button
										*ngIf="badgeClassForm.controls.alignments.controls.length > 1"
										type="button"
										(click)="removeAlignment(alignment)"
										class="u-text-link"
									>
										{{ 'General.remove' | translate }}
									</button>
								</div>
								<div class="forminput u-margin-bottom6x">
									<div class="forminput-x-inputs">
										<bg-formfield-text
											[control]="alignment.rawControlMap.target_name"
											label="Name"
											[errorMessage]="{ required: alignmentNameError }"
											id="alignment_name_{{ i }}"
										></bg-formfield-text>

										<bg-formfield-text
											[control]="alignment.rawControlMap.target_url"
											label="URL"
											[errorMessage]="{ required: alignmentURLError }"
											[urlField]="true"
											id="alignment_url_{{ i }}"
										></bg-formfield-text>

										<bg-formfield-text
											[control]="alignment.rawControlMap.target_description"
											[label]="shortDescription"
											[multiline]="true"
											id="alignment_description_{{ i }}"
										></bg-formfield-text>

										<button
											*ngIf="!showAdvanced[i]"
											(click)="showAdvanced[i] = true"
											type="button"
											class="u-text-link-small u-margin-yaxis2x"
										>
											{{ 'General.show' | translate }}
											{{ 'CreateBadge.additionalOptions' | translate }}
										</button>

										<ng-template [ngIf]="showAdvanced[i]">
											<button
												(click)="showAdvanced[i] = false"
												type="button"
												class="u-text-link-small u-margin-yaxis2x"
											>
												{{ 'General.hide' | translate }}
												{{ 'CreateBadge.additionalOptions' | translate }}
											</button>

											<label class="forminput-x-label u-margin-top2x" for="forminput2">{{
												'CreateBadge.frame' | translate
											}}</label>
											<input type="text" id="forminput2" name="forminput2" />

											<label class="forminput-x-label u-margin-top2x" for="url">Code</label>
											<input type="text" id="url" name="url" />
										</ng-template>
									</div>
								</div>
							</ng-container>

							<div class="l-stack">
								<button (click)="addAlignment()" type="button" class="button button-secondary">
									{{ 'CreateBadge.addAlignment' | translate }}
								</button>
							</div>
						</div>
					</div>
				</li>
				<li class="tw-mt-4">
					<button
						type="button"
						(click)="expirationEnabled ? disableExpiration() : enableExpiration()"
						class="options-dropdown"
					>
						<span class="tw-text-md md:tw-text-lg">{{ 'CreateBadge.expiration' | translate }}</span>
					</button>
					<!-- expiration -->
					<div *ngIf="expirationEnabled" class="formsection tw-bg-inherit tw-mt-2 tw-border-none">
						<div class="formsection-x-title">
							<h2 class="u-text-dark2">
								{{ 'CreateBadge.expiration' | translate }}
								<span>(Optional)</span>
							</h2>
							<button type="button" (click)="disableExpiration()" class="buttonicon buttonicon-link">
								<svg icon="icon_close"></svg>
								<span class="visuallyhidden">Schliessen</span>
							</button>
						</div>

						<div class="formsection-x-help">
							<h3 class="u-text-body-bold">
								{{ 'CreateBadge.whatIsThe' | translate }} {{ 'CreateBadge.expiration' | translate }}?
							</h3>
							<p class="u-text u-margin-top1x u-margin-bottom2x">
								{{ 'CreateBadge.expirationInfo' | translate }}
							</p>
						</div>
						<div class="formsection-x-body">
							<div class="l-spacestack">
								<bg-formfield-text
									[control]="expirationForm.rawControlMap.expires_amount"
									[label]="count"
									[fieldType]="'number'"
									[max]="1000"
									[maxchar]="4"
								></bg-formfield-text>
								<bg-formfield-select
									ariaLabel="chooseDuration"
									[control]="expirationForm.rawControlMap.expires_duration"
									[label]="duration"
									[placeholder]="chooseDuration"
									[optionMap]="durationOptions"
								></bg-formfield-select>
							</div>
						</div>
					</div>
				</li>
			</ul>
		</div>
	</div>

	<div class="l-stack l-stack-right u-margin-top3x">
		<button
			type="button"
			[disabled-when-requesting]="true"
			(click)="cancelClicked()"
			class="button button-secondary"
		>
			{{ 'General.cancel' | translate }}
		</button>
		<button
			type="submit"
			class="button"
			style="background-color: #492e98"
			[disabled]="!!savePromise"
			[loading-promises]="[savePromise]"
			loading-message="{{ submittingText }}"
		>
			<ng-container *ngIf="existingBadgeClass; else createBadgeText">
				{{ 'General.saveChanges' | translate }}
			</ng-container>
			<ng-template #createBadgeText>
				{{ 'Issuer.createBadge' | translate }}
			</ng-template>
		</button>
	</div>
</form>
