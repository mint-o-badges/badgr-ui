<div class="tw-border-purple tw-bg-white tw-border-solid tw-border tw-p-6 tw-rounded-[15px] tw-mb-8">
	<div class="!tw-shadow-none tw-p-6" role="group" aria-labelledby="heading-addoptionaldetails">
		<h3 class="tw-uppercase tw-text-lg tw-font-semibold tw-text-oebblack tw-mb-6" id="heading-addoptionaldetails">
			{{ 'Issuer.addOptionalDetails' | translate }}
		</h3>

		<ul class="tw-list-none tw-p-0 tw-m-0 tw-flex tw-flex-col">
			<!--Expiration Item-->
			@if (showExpiration && hasControl('valid_from') && hasControl('expires_at')) {
				<li>
					<ng-template #collapseExpirationTrigger>
						<ng-icon size="24px" hlm name="lucideClockFading" class="tw-mr-1 tw-text-oebblack"></ng-icon>
						<span
							[class.tw-font-semibold]="expirationCollapsible.expanded"
							[class.tw-font-normal]="!expirationCollapsible.expanded"
							class="tw-text-lg tw-text-oebblack tw-mr-auto"
							[innerHTML]="'QrCode.expiration' | translate"
						></span>
					</ng-template>
					<oeb-collapsible
						#expirationCollapsible
						[trigger]="collapseExpirationTrigger"
						[defaultOpen]="false"
						[closeIcon]="'lucideChevronDown'"
						[iconStyle]="'tw-text-oebblack'"
						[iconSize]="'lg'"
					>
						<div class="tw-flex tw-flex-col md:tw-flex-row tw-gap-4 tw-pt-4">
							<oeb-input
								[noTopMargin]="true"
								[labelStyle]="'tw-text-oebblack tw-font-normal tw-text-lg'"
								[label]="'QrCode.expirationStart' | translate"
								[errorMessage]="{
									invalidDate: 'QrCode.invalidDate' | translate,
								}"
								[control]="getRawControl('valid_from')"
								fieldType="date"
							></oeb-input>
							<oeb-input
								[noTopMargin]="true"
								[labelStyle]="'tw-text-oebblack tw-font-normal tw-text-lg'"
								[label]="'QrCode.expirationEnd' | translate"
								[errorMessage]="{
									expiresBeforeValidFrom: ('QrCode.invalidExpirationDateRange' | translate),
									invalidDate: ('QrCode.invalidDate' | translate),
								}"
								[control]="getRawControl('expires_at')"
								fieldType="date"
							></oeb-input>
						</div>
					</oeb-collapsible>
				</li>

				<oeb-separator
					[separatorStyle]="'tw-block tw-my-4 !tw-border !tw-border-dashed tw-border-darkgrey'"
				></oeb-separator>
			}

			<!-- Evidence Item -->
			@if (showEvidence && hasControl('evidence_items')) {
				<li>
					<ng-template #collapseEvidenceTrigger>
						<span
							[class.tw-font-semibold]="evidenceCollapsible.expanded"
							[class.tw-font-normal]="!evidenceCollapsible.expanded"
							class="tw-text-lg tw-text-oebblack tw-mr-auto"
							[innerHTML]="'Issuer.evidence' | translate"
						></span>
					</ng-template>
					<oeb-collapsible
						#evidenceCollapsible
						[trigger]="collapseEvidenceTrigger"
						[closeIcon]="'lucideChevronDown'"
						[iconStyle]="'tw-text-oebblack'"
						[iconSize]="'lg'"
					>
						<div class="tw-space-y-4 tw-pt-4">
							@for (evidence of evidenceItems?.controls; let i = $index; track i; let isLast = $last) {
								<div class="tw-mb-4">
									<div class="tw-flex tw-flex-col tw-gap-4">
										<oeb-input
											[control]="evidence.get('evidence_url')"
											[label]="'Issuer.evidenceUrl' | translate"
											[labelStyle]="'tw-text-oebblack tw-text-lg tw-font-normal'"
											[placeholder]="'https://example.com'"
											[noTopMargin]="true"
											[urlField]="true"
											[fieldType]="'url'"
											errorMessage="{{ 'Issuer.enterURL' | translate }}"
										></oeb-input>
										<oeb-input
											[control]="evidence.get('narrative')"
											[label]="'Issuer.evidenceNarrative' | translate"
											[labelStyle]="'tw-text-oebblack tw-text-lg tw-font-normal'"
											[noTopMargin]="true"
											fieldType="textarea"
											[size]="'lg'"
										></oeb-input>
									</div>

									<div class="tw-flex tw-justify-between tw-items-center tw-mt-3">
										@if (isLast) {
											<oeb-button
												[text]="'Issuer.addNewEvidence' | translate"
												variant="secondary"
												[weight]="'normal'"
												size="sm"
												(click)="addEvidence(); $event.stopPropagation()"
											>
											</oeb-button>
										}
										<oeb-button
											[text]="'General.remove' | translate"
											type="button"
											(click)="removeEvidence(i); $event.stopPropagation()"
											variant="destructive"
											size="sm"
											weight="normal"
											class="tw-ml-auto"
										>
										</oeb-button>
									</div>
								</div>
							}

							@if (evidenceItems?.controls?.length === 0) {
								<oeb-button
									[text]="'Issuer.addNewEvidence' | translate"
									variant="secondary"
									weight="normal"
									size="sm"
									(click)="addEvidence(); $event.stopPropagation()"
								>
								</oeb-button>
							}
						</div>
					</oeb-collapsible>
				</li>

				<oeb-separator
					[separatorStyle]="'tw-block tw-my-4 !tw-border !tw-border-dashed tw-border-darkgrey'"
				></oeb-separator>
			}

			<!-- Course Date Item -->
			@if (showCourseDate && hasControl('activity_start_date') && hasControl('activity_end_date')) {
				<li>
					<ng-template #collapseCourseDateTrigger>
						<ng-icon size="24px" hlm name="lucideCalendarDays" class="tw-mr-1"></ng-icon>
						<span
							[class.tw-font-semibold]="courseDateCollapsible.expanded"
							[class.tw-font-normal]="!courseDateCollapsible.expanded"
							class="tw-text-lg tw-font-normal tw-text-oebblack tw-mr-auto"
							[innerHTML]="'RecBadge.courseDate' | translate"
						></span>
					</ng-template>

					<oeb-collapsible
						#courseDateCollapsible
						[trigger]="collapseCourseDateTrigger"
						[defaultOpen]="false"
						[closeIcon]="'lucideChevronDown'"
						[iconStyle]="'tw-text-oebblack'"
						[iconSize]="'lg'"
					>
						<div class="tw-flex tw-gap-4 tw-pt-4">
							<oeb-input
								[control]="getRawControl('activity_start_date')"
								[label]="'General.start' | translate"
								[labelStyle]="'tw-text-oebblack tw-font-normal tw-text-lg'"
								fieldType="date"
								[noTopMargin]="true"
								[errorMessage]="'CreateBadge.activityStartDateRequired' | translate"
							></oeb-input>
							<oeb-input
								[control]="getRawControl('activity_end_date')"
								[label]="'General.end' | translate"
								[labelStyle]="'tw-text-oebblack tw-font-normal tw-text-lg'"
								fieldType="date"
								[noTopMargin]="true"
								[errorMessage]="'CreateBadge.activityEndDateRequired' | translate"
							></oeb-input>
						</div>
					</oeb-collapsible>
				</li>

				@if (showVenue && hasControl('activity_zip')) {
					<oeb-separator
						[separatorStyle]="'tw-block tw-my-4 !tw-border !tw-border-dashed tw-border-darkgrey'"
					></oeb-separator>
				}
			}

			<!-- Venue Item -->
			@if (showVenue && hasControl('activity_zip')) {
				<li>
					<ng-template #venueTrigger>
						<ng-icon size="24px" hlm name="lucideMapPin" class="tw-mr-1"></ng-icon>
						<span
							[class.tw-font-semibold]="activityPlaceCollapsible.expanded"
							[class.tw-font-normal]="!activityPlaceCollapsible.expanded"
							class="tw-text-lg tw-text-oebblack tw-mr-auto"
							[innerHTML]="'RecBadge.venue' | translate"
						></span>
					</ng-template>
					<oeb-collapsible
						#activityPlaceCollapsible
						[trigger]="venueTrigger"
						[defaultOpen]="false"
						[closeIcon]="'lucideChevronDown'"
						[iconStyle]="'tw-text-oebblack'"
						[iconSize]="'lg'"
					>
						<section class="tw-flex tw-flex-col tw-gap-4 tw-pt-4">
							<div class="tw-flex tw-gap-4">
								@if (hasControl('activity_zip')) {
									<oeb-input
										[control]="getRawControl('activity_zip')"
										[label]="'General.postalCode' | translate"
										[labelStyle]="'tw-text-oebblack tw-font-normal tw-text-lg'"
										[noTopMargin]="true"
										fieldType="number"
									></oeb-input>
								}
								@if (hasControl('activity_city')) {
									<oeb-input
										[control]="getRawControl('activity_city')"
										[label]="'RecBadgeDetail.place' | translate"
										[labelStyle]="'tw-text-oebblack tw-font-normal tw-text-lg'"
										[noTopMargin]="true"
									></oeb-input>
								}
							</div>
							@if (hasControl('activity_online')) {
								<span class="tw-text-lg tw-text-oebblack">{{ 'General.or' | translate }}</span>
								<oeb-checkbox [text]="'Online'" [control]="getRawControl('activity_online')">
								</oeb-checkbox>
							}
						</section>
					</oeb-collapsible>
				</li>
			}
		</ul>
	</div>
</div>
