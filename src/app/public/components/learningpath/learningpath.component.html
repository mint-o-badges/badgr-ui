<div class="oeb tw-relative tw-w-full">
	<ng-template [bgAwaitPromises]="[issuerLoaded, badgeLoaded, loaded]">
		<div class="oeb-section tw-bg-lightpurple">
			<div class="page-padding tw-flex tw-justify-between tw-flex-wrap tw-gap-8">
				<div>
					<div class="oeb-headline-container">
						<h1 class="tw-text-oebblack tw-font-extrabold" hlmH1>{{learningPath.name}}</h1>
						<p size="sm" hlmP class="tw-text-oebblack tw-mt-2">
							{{'LearningPath.lpFrom' | translate}} <a hlmA [routerLink]="['/public/issuers/', issuer.slug ]">{{issuer.name}}</a>
						</p>
						<div class="tw-flex tw-flex-row tw-gap-2 tw-text-[#6B7280] tw-mt-1 tw-items-end">
							<hlm-icon name="lucideClock" />
							<span>{{minutesTotal | hourPipe}} {{'LearningPath.hours' | translate}}</span>
						</div>
					</div>
					<form *ngIf="sessionService.isLoggedIn" (ngSubmit)="participate()" novalidate>
						<oeb-button *ngIf="!learningPath.requested" [variant]="participantButtonVariant" hlmBtn type="submit"
							[text]="participationButtonText"></oeb-button>
						<h3 *ngIf="learningPath.requested && !learningPath.completed" class="tw-text-purple" hlmH3>{{'LearningPath.successRequestPath' | translate}}</h3>
					</form>
				</div>
				<div
					class="tw-relative tw-grow tw-px-16 tw-py-8 tw-bg-oebgrey tw-rounded-[12px] tw-flex tw-justify-center tw-items-center tw-max-w-[500px] md:tw-min-w-[250px]">
					<div class="tw-absolute tw-top-[12px] tw-right-[12px]">
						<img src="/assets/oeb/images/learningPath/learningPathIcon.png" class="tw-w-[40px]"
							alt="LearningPath" />
					</div>
					<img class="tw-w-[120.88px] tw-h-[120.88px] md:tw-w-[172.69px] md:tw-h-[172.69px] tw-mx-auto tw-block"
						[loaded-src]="badge.image" />
				</div>
			</div>
		</div>
		<div class="page-padding">
			<div class="md:tw-grid md:tw-gap-8 md:tw-grid-cols-5 ">
				<div class="tw-col-span-3">
					<div class="oeb-section-sm">
						<h3 hlmH3 class="tw-text-oebblack tw-font-bold">{{'LearningPath.desc' | translate}}</h3>
						<p hlmP>{{learningPath.description}}</p>
					</div>
					<div class="oeb-section-sm">
						<h3 hlmH3 class="tw-text-oebblack tw-font-bold tw-pb-4">Enthaltene Badges</h3>
						<oeb-backpack-tabs *ngIf="loggedIn; else allTemplate" (onTabChanged)="onTabChange($event)" [tabs]="tabs" [activeTab]="'Alle'" [variant]="'lightpurple'"></oeb-backpack-tabs>

					</div>

				</div>
				<div class="tw-col-span-2" *bgAwaitPromises="[issuerLoaded]">
					<ng-template #progessTemplate>
						<div class="tw-absolute tw-flex tw-flex-col tw-w-full tw-text-right tw-right-4">
							<span hlmH1
								class="tw-font-extrabold tw-text-purple">{{(minutesCompleted / minutesTotal * 100).toFixed(0)
								}} %</span>
							<span hlmP class="tw-mt-2 tw-text-oebblack">{{minutesCompleted | hourPipe}} / {{minutesTotal | hourPipe}} h</span>
						</div>
					</ng-template>

					<div *ngIf="progressPercentage"
						class="tw-rounded-[10px] tw-bg-white tw-border-[#CFCECE] tw-border-solid tw-border tw-relative tw-p-4 tw-block tw-overflow-hidden">
						<div class="tw-flex tw-flex-col tw-h-full">
							<div class="tw-flex tw-flex-row tw-gap-2 tw-text-oebblack tw-mt-2 tw-pb-4 tw-items-end">
								<hlm-icon class="tw-text-[#6B7280]" name="lucideClock" />
								<span hlmP class="tw-font-medium">{{'LearningPath.myProgress' | translate}}</span>
							</div>
							<div class="tw-w-full tw-flex tw-justify-center tw-items-center">
								<oeb-progress
									class="tw-w-full tw-h-20 md:tw-h-32 tw-relative tw-inline-flex tw-overflow-hidden tw-rounded-3xl tw-bg-[var(--color-grayinteractive)] tw-items-center"
									[value]="minutesCompleted / minutesTotal * 100" [template]="progessTemplate"></oeb-progress>
							</div>
							<div *ngIf="learningPath.completed_badges" class="tw-flex md:tw--space-x-6 tw--space-x-4 tw-pt-4 pt-pb-4">
								<div class="hover:tw-scale-105 hover:tw-z-10 tw-transform tw-ease-in-out tw-transition tw-duration-200"
									*ngFor="let badge of learningPath.completed_badges">
									<img [src]="badge.image" [title]="badge?.name" class="md:tw-w-[80px] md:tw-h-[80px] tw-w-[50px] tw-h-[50px]" />
								</div>
							</div>
						</div>
					</div>

					<oeb-issuerCard class="tw-mt-8" [issuer]="issuer"></oeb-issuerCard>
				</div>
			</div>
		</div>
	</ng-template>
	<div class="page-padding">

	</div>
	
	<ng-template #allTemplate>
		<ng-template [bgAwaitPromises]="[issuerLoaded, badgeLoaded, loaded]">
			<div class="tw-relative tw-flex tw-gap-4 tw-pt-4"
				*ngFor="let badge of learningPath.badges.reverse(); let i = index">
				<bg-badgecard class="tw-w-[350px]" [badgeImage]="badge.badge.image" [badgeTitle]="badge.badge.name"
					[issuerTitle]="badge.badge.issuerName" [badgeDescription]="badge.badge.description"
					[badgeSlug]="badge.badge.slug" [badgeIssueDate]="badge.badge.createdAt" public="true"
					[publicUrl]="'/public/badges/'+ badge.badge.slug" [badgeClass]="true"></bg-badgecard>
			</div>
		</ng-template>
	</ng-template>
	<ng-template #openTemplate>
		<ng-template [bgAwaitPromises]="[issuerLoaded, badgeLoaded, loaded]">
			<div class="tw-relative tw-flex tw-gap-4 tw-pt-4" *ngFor="let badge of openBadges.reverse(); let i = index">
				<bg-badgecard class="tw-w-[350px]" [badgeImage]="badge.badge.image" [badgeTitle]="badge.badge.name"
					[issuerTitle]="badge.badge.issuerName" [badgeDescription]="badge.badge.description"
					[badgeSlug]="badge.badge.slug" [badgeIssueDate]="badge.badge.createdAt" public="true"
					[publicUrl]="'/public/badges/'+ badge.badge.slug" [badgeClass]="true"></bg-badgecard>
			</div>
		</ng-template>
	</ng-template>
	<ng-template #finishedTemplate>
		<ng-template [bgAwaitPromises]="[issuerLoaded, badgeLoaded, loaded]">
				<div class="tw-relative tw-flex tw-gap-4 tw-pt-4"
					*ngFor="let badge of learningPath.completed_badges; let i = index">
					<bg-badgecard class="tw-w-[350px]" [badgeImage]="badge.image" [badgeTitle]="badge.name"
						[issuerTitle]="badge.issuerName" [badgeDescription]="badge.description" [badgeSlug]="badge.slug"
						[badgeIssueDate]="badge.createdAt" public="true" [publicUrl]="'/public/badges/'+ badge.slug"
						[badgeClass]="true"></bg-badgecard>
				</div>
		</ng-template>
	</ng-template>
</div>